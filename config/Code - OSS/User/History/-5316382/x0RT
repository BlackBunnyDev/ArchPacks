#!/bin/bash

# Check if yt-dlp and ffmpeg are installed
if ! command -v yt-dlp &> /dev/null || ! command -v ffmpeg &> /dev/null; then
    echo "yt-dlp or ffmpeg is not installed. Please install them first."
    exit 1
fi

# Check if the playlist link is provided
if [ -z "$1" ]; then
    echo "Usage: $0 <yt-playlist-link>"
    exit 1
fi

# Download playlist with mp3 format and metadata
yt-dlp --extract-audio --audio-format mp3 --add-metadata --embed-thumbnail -o "%(title)s.%(ext)s" "$1"

# Add metadata to downloaded mp3 files
for file in *.mp3; do
    ffmpeg -i "$file" -vn -acodec copy -metadata title="Title" -metadata artist="Artist" -metadata album="Album" -metadata date="Date" "$file.tmp" && mv "$file.tmp" "$file"
done

echo "Conversion completed successfully."
exit 0
